<!-- âœ… User Registration Form -->
<section id="user-register" class="bg-white shadow p-6 rounded-lg mb-10">
  <h2 class="text-lg font-bold mb-4">ğŸ‘¤ Register as a Customer</h2>
  <form id="user-form" class="space-y-4">
    <label>
      <input type="text" name="username" placeholder="Full Name" required class="border p-2 rounded w-full" />
    </label>
    <label>
      <input type="email" name="email" placeholder="Email Address" required class="border p-2 rounded w-full" />
    </label>
    <label>
      <input type="tel" name="phone" placeholder="WhatsApp Number" required class="border p-2 rounded w-full" />
    </label>
    <label>
      <input type="text" name="userAddress" placeholder="Current Address" id="user-location" readonly class="border p-2 rounded w-full bg-gray-100" />
    </label>
    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Register User</button>
    <p id="user-msg" class="text-sm mt-2 text-green-600 hidden">âœ… Registration successful!</p>
  </form>
</section>

<!-- âœ… Business Registration Form -->
<section id="business-register" class="bg-white shadow p-6 rounded-lg mb-10">
  <h2 class="text-lg font-bold mb-4">ğŸ¢ Register Your Business</h2>
  <form id="business-form" class="space-y-4">
    <label>
      <input type="text" name="businessName" placeholder="Business Name" required class="border p-2 rounded w-full" />
    </label>
    <label>
      <select name="category" id="category-dropdown" required class="border p-2 rounded w-full">
        <option value="">Select Business Category</option>
      </select>
    </label>
    <label>
      <input type="text" name="address" placeholder="Business Location (Auto)" id="business-location" readonly class="border p-2 rounded w-full bg-gray-100" />
    </label>
    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Register Business</button>
    <p id="biz-msg" class="text-sm mt-2 text-green-600 hidden">âœ… Business registered successfully!</p>
  </form>
</section>

<!-- âœ… Display Listed Businesses -->
<section id="business-list" class="mb-10">
  <h2 class="text-xl font-semibold mb-4">ğŸ“Œ Listed Businesses by Category</h2>
  <div id="business-container" class="space-y-6">Loading businesses...</div>
</section>

<!-- âœ… Inline Script -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // âœ… Autofill location
    const fillLocation = (inputId) => {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const input = document.getElementById(inputId);
            if (input) {
              input.value = `Lat: ${pos.coords.latitude}, Lng: ${pos.coords.longitude}`;
            }
          },
          (err) => {
            console.warn("Geolocation failed:", err.message);
            const input = document.getElementById(inputId);
            if (input) {
              input.placeholder = "Location not available";
            }
          }
        );
      }
    };

    fillLocation("user-location");
    fillLocation("business-location");

    // âœ… Load categories into dropdown
    const loadCategories = () => {
      fetch('/.netlify/functions/list-businesses')
        .then(res => res.json())
        .then(data => {
          const dropdown = document.getElementById("category-dropdown");
          const categories = [...new Set(data.map(b => b.category))];
          categories.forEach(cat => {
            const opt = document.createElement("option");
            opt.value = cat;
            opt.textContent = cat;
            dropdown.appendChild(opt);
          });
        })
        .catch(err => console.error("Failed to load categories", err));
    };

    loadCategories();

    // âœ… Handle User Registration
    const userForm = document.getElementById("user-form");
    userForm?.addEventListener("submit", (e) => {
      e.preventDefault();
      const msg = document.getElementById("user-msg");
      msg?.classList.remove("hidden");
      setTimeout(() => msg?.classList.add("hidden"), 3000);
    });

    // âœ… Handle Business Registration
    const bizForm = document.getElementById("business-form");
    bizForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        businessName: bizForm.businessName.value,
        category: bizForm.category.value,
        address: bizForm.address.value,
      };

      try {
        const res = await fetch("/.netlify/functions/register-business", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const result = await res.json();
        if (res.ok) {
          const msg = document.getElementById("biz-msg");
          msg?.classList.remove("hidden");
          setTimeout(() => msg?.classList.add("hidden"), 3000);
          bizForm.reset();
        } else {
          alert("âŒ Error: " + (result.error || "Unknown error"));
        }
      } catch (err) {
        alert("âŒ Network Error: " + err.message);
      }
    });
  });
</script>

<!-- âœ… External Modules -->
<script type="module" src="./js/geo-nearby.js"></script>
<script type="module" src="./js/register-business.js"></script>
<script type="module" src="./js/gps.js"></script>
<script type="module" src="./src/main.jsx"></script>
